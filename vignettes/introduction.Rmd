---
title: "Introduction to healthbR"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction to healthbR}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  eval = FALSE
)
```

## Overview

`healthbR` provides easy access to Brazilian public health data from multiple sources. The package downloads data directly from official government sources and returns clean, tidy data frames ready for analysis.

## Installation

```{r}
# Install from GitHub
# install.packages("remotes")
remotes::install_github("SidneyBissoli/healthbR")
```

## Quick Start

```{r setup}
library(healthbR)
library(dplyr)
```

### Check Available Data Sources

```{r}
# see all data sources
list_sources()
```

### VIGITEL - Risk Factor Surveillance

VIGITEL is a telephone survey monitoring risk and protective factors for chronic diseases in Brazilian state capitals.

```{r}
# check available years
vigitel_years()

# get survey information
vigitel_info()

# list variables for a specific year
vigitel_variables(2023)
```

### Downloading and Loading Data

```{r}
# download and load 2023 data
df <- vigitel_data(2023)

# check dimensions
dim(df)

# view first rows
head(df)
```

### Selecting Specific Variables

```{r}
# load only specific variables
df <- vigitel_data(
  year = 2023,
  vars = c("cidade", "sexo", "idade", "pesorake", "q6", "q7")
)
```

### Variable Dictionary

```{r}
# get the data dictionary
dict <- vigitel_dictionary()

# search for variables related to weight
dict |> 
  filter(stringr::str_detect(tolower(descricao), "peso"))
```

## Working with Survey Weights

VIGITEL uses complex sampling with post-stratification weights. For proper statistical analysis, use the `srvyr` or `survey` packages:
package:
```{r}
library(srvyr)

# create survey design
vigitel_svy <- df |>
  as_survey_design(weights = pesorake)

# calculate weighted prevalence
vigitel_svy |>
  group_by(cidade) |>
  summarise(
    mean_age = survey_mean(idade, na.rm = TRUE),
    n = unweighted(n())
  )
```

## Data Sources Roadmap

| Source | Status | Description |
|--------|--------|-------------|
| VIGITEL | Available | Chronic disease risk factors |
| PNS | Planned | National Health Survey |
| SIM | Planned | Mortality data |
| SINASC | Planned | Live births data |
| SINAN | Planned | Notifiable diseases |
| SIH | Planned | Hospital admissions |
| CNES | Planned | Health facilities |

## Cache Management

Downloaded files are cached locally to avoid repeated downloads:

```{r}
# clear cache if needed
vigitel_clear_cache()
```

## Getting Help

If you encounter issues or have questions:

1. Check the function documentation: `?vigitel_data`
2. Open an issue on GitHub: https://github.com/SidneyBissoli/healthbR/issues

## Citation

If you use healthbR in your research, please cite it:

```
@software{healthbR,
  author = {Silva, Sidney},
  title = {healthbR: Access Brazilian Public Health Data},
  url = {https://github.com/SidneyBissoli/healthbR},
  year = {2026}
}
```
